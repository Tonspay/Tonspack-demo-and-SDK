class Tonspack{constructor(t,o){if(t){this.uuid=t}else{this.uuid=crypto.randomUUID()}if(o?.baseurl){this.baseurl=o.baseurl}else{this.baseurl="https://pack.tons.ink/api"}if(o?.actionUrl){this.actionUrl=o.actionUrl}else{this.actionUrl="https://t.me/tonspack_bot/connect?startapp="}if(o?.loopInterval){this.loopInterval=o.loopInterval}else{this.loopInterval=500}if(o?.loopTimeout){this.loopTimeout=o.loopTimeout}else{this.loopTimeout=120}}async loopCheck(){for(var t=0;t<this.loopTimeout;t++){const o=await this.check_request_action();if(o.data){return o.data}await this.sleep(this.loopInterval)}return{status:false,reason:"user operation timeout"}}async sleep(o){return new Promise(t=>{setTimeout(t,o)})}async check_request_action(){try{return(await fetch(this.baseurl+"/result/"+this.uuid,{method:"GET",headers:{},redirect:"follow"})).json()}catch(t){console.error(t);return false}}async connect(t,o){const e=window.location.origin;const i={t:0,i:this.uuid,d:e,c:t,r:o||null};window.open(this.actionUrl+base58.encode(Buffer.from(JSON.stringify(i))),"newwindow","height=800, width=400, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");return await this.loopCheck()}async sign(t,o,e,i){var n={t:1,i:this.uuid,d:o,c:t,r:e||null};if(i){var s=new Headers;s.append("Content-Type","application/json");var r={method:"POST",headers:s,body:JSON.stringify({data:base58.encode(Buffer.from(JSON.stringify(n)))}),redirect:"follow"};await fetch(`${this.baseurl}/preconnect/${n.i}`,r);n={i:this.uuid,p:1}}window.open(this.actionUrl+base58.encode(Buffer.from(JSON.stringify(n))),"newwindow","height=800, width=400, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");return await this.loopCheck()}async send(t,o,e,i){var n={t:2,i:this.uuid,d:o,c:t,r:e||null};if(i){var s=new Headers;s.append("Content-Type","application/json");var r={method:"POST",headers:s,body:JSON.stringify({data:base58.encode(Buffer.from(JSON.stringify(n)))}),redirect:"follow"};await fetch(`${this.baseurl}/preconnect/${n.i}`,r);n={i:this.uuid,p:1}}window.open(this.actionUrl+base58.encode(Buffer.from(JSON.stringify(n))),"newwindow","height=800, width=400, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");return await this.loopCheck()}}